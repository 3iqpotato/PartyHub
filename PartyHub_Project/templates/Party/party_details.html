{% extends "Common/base.html" %}
{% load static %}
{% block styles %}
    <link rel="stylesheet" href="{% static 'css/Parties_css/party_details.css' %}">
{% endblock %}
{% block content %}
<div class="party-details-container">
    <h2>{{ party.name }}</h2>
    
    <div class="party-details-content">
        <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –ø–∞—Ä—Ç–∏—Ç–æ -->
        {% if party.image %}
            <img src="{{ party.picture.url }}" alt="Party Image" class="party-image">
        {% else %}
            <img src="{% static 'images/img.png' %}" alt="Default Party Image" class="party-image">
        {% endif %}

        <div class="party-info">
            <p><strong>Title:</strong> {{ party.title }}</p>
            <p><strong>Start:</strong> {{ party.start_time }}</p>
            <p><strong>End:</strong> {{ party.end_time }}</p>
            <p><strong>Location:</strong> {{ party.location }}</p>
            <p><strong>Organizer:</strong> {{ party.organizer.username }}</p>
            <p><strong>Description:</strong> {{ party.description }}</p>
            <p><strong>Attendees:</strong> {{ party.tickets.count }} people</p>
            
            <!-- –ë—É—Ç–æ–Ω –∑–∞ —É—á–∞—Å—Ç–∏–µ –∏–ª–∏ –Ω–∞–ø—É—Å–∫–∞–Ω–µ –Ω–∞ –ø–∞—Ä—Ç–∏—Ç–æ -->
            {% if user.is_authenticated %}
{#                {% if party.organizer == user %}#}
                {% if status == 'owner' %}
                    <a href="{% url 'delete_party' party.slug %}" class="details-link delete-party">Delete Party</a>
                    <a href="{% url 'edit_party' party.slug %}" class="details-link edit-party">Edit Party</a>


                {% else %}
                    {% if  status == 'can_buy'%}
                        <button type="submit" class="join-party-button" onclick="window.location.href='{% url 'get_ticket' party.slug %}'">Buy Ticket</button>
                    {% else %}
                        <div class="no-ticket-message">
                                {% if status == 'no_spots' %}
                                    <p>üéüÔ∏è Sorry, party's all packed! No tickets left. üéâ</p>
                                    {% elif status == 'have_ticket' %}
                                        <p>Owlready have a ticket</p>
{#                                    <p>‚è∞ Oh no, you missed it! The party has already started! üï∫üíÉ</p>#}
{#                                {% elif party.has_ended %}#}
{#                                    <p>üö™ The party's over, and the dance floor is closed. Hope to see you at the next one! ü•≥</p>#}
                                {% elif status == late_for_tickets %}
                                    <p>‚è≥ Oops! Ticket sales closed on {{ party.registration_deadline }}. Better luck next time! üòâ</p>
                                {% else %}
                                    <p>üö´ Unfortunately, tickets are unavailable for this event. Stay tuned for more!</p>
                                {% endif %}
                        </div>

                        {% endif %}
                {% endif %}
            {% else %}
                <p>Please <a href="{% url 'login' %}">log in</a> to join this party.</p>
            {% endif %}
        {% if user.is_authenticated %}
                {% if question_form %}
                    <div class="questions-section">
                        <h3>Ask a Question:</h3>
                        <form method="post" action="{% url 'question_create' party.slug %}">
                            {% csrf_token %}
                            {{ question_form.as_p }}
                            <button type="submit" class="question-button">Post Question</button>
                        </form>
                    </div>
                {% endif %}
            {% endif %}

            <div class="questions-list">
                {% for question in party.questions.all %}
                    <div class="question">
                        <p><strong>{{ question.author.username }}:</strong> {{ question.text }}</p>
                        {% if question.answer %}
                            <div class="answer">
                                <p><strong>Answer from {{ question.answer.author.username }}:</strong> {{ question.answer.text }}</p>
                            </div>
                        {% else %}
                            {% if user.is_authenticated and answer_form %}
                                <form method="post" action="{% url 'answer_create' question.pk party.slug %}">
                                    {% csrf_token %}
                                    {{ answer_form.as_p }}
                                    <button type="submit" class="answer-button">Post Answer</button>
                                </form>
                            {% endif %}
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
{#        {% if user.is_authenticated %}#}
{#            {% if question_form %}#}
{#                <form method="post" action="{% url 'question_create' party.slug %}">#}
{#                    {% csrf_token %}#}
{#                    {{ question_form }}#}
{#                <button>Post question</button>#}
{#                </form>#}
{#                {% endif %}#}
{#        {% endif %}#}
{#        {% for question in party.questions.all %}#}
{#            {{ question.author }}{{ question.text }}#}
{#            {% if question.answer %}#}
{#                {{  question.answer.text }} from  {{  question.answer.author }}#}
{#                {% else %}#}
{#                {% if answer_form %}#}
{#                    <form method="post" action="{% url 'answer_create' question.pk party.slug %}">#}
{#                        {% csrf_token %}#}
{#                        {{ answer_form }}#}
{#                        <button>Post answer</button>#}
{#                    </form>#}
{#                    {% endif %}#}
{#            {% endif %}#}
{#        {% endfor %}#}
        </div>
    </div>
</div>
{% endblock %}
